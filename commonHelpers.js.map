{"version":3,"file":"commonHelpers.js","sources":["../src/main.js"],"sourcesContent":["\nimport iziToast from \"izitoast\";\nimport \"izitoast/dist/css/iziToast.min.css\";\nimport axios from 'axios';\nimport SimpleLightbox from \"simplelightbox\";\nimport \"simplelightbox/dist/simple-lightbox.min.css\";\n\nconst BASE_URL= \"https://pixabay.com/api/\";\nconst API_KEY = \"41911500-2109ce3c8bb16633259977e96\";\n\nconst container = document.querySelector('.gallery');\nconst form = document.querySelector('.search-form');\nconst input= document.querySelector('.search-input');\nconst startBtn= document.querySelector('.start-btn');\nconst loader = document.querySelector('.loader');\nconst loadMoreBtn = document.querySelector('.load-btn');\nconst preloader = document.querySelector('loader-load');\n\nconst hiddenClass=  \"is-hidden\";\nlet inputValue = \"\";\nlet page = 1;\nlet maxPage = 0;\n\n\nconst refreshPage = new SimpleLightbox('.gallery a', {\n  captionsData: 'alt',\n  captionDelay: 250,\n});\n\n// const axios = require('axios').default;\n\n\nloader.style.display = 'none';\nform.addEventListener('submit', handleSearch)\n\nfunction handleSearch(event){\n  event.preventDefault();\n  loader.style.display = 'block';\n  inputValue = event.target.elements.query.value;\n  fetchImage(inputValue)\n  .then(data => {\n    loader.style.display = 'none';\n      if(!data.hits.length){\n          iziToast.error({\n              title: 'Error',\n              message:\n                'Sorry, there are no images matching your search query. Please try again!',\n            });\n      } \n      container.innerHTML = \"\";\n      page = 1;\n      try {\n       \n        container.innerHTML = createMarkup(data.hits);\n      // const refreshPage = new SimpleLightbox('.gallery a', {\n      //     captionsData: 'alt',\n      //     captionDelay: 250,\n      //   });\n        refreshPage.refresh();\n        scrollBy();\n        // ------------кнопка ще\n        if(data.totalHits > 0){\n          loadMoreBtn.classList.remove(hiddenClass);\n          loadMoreBtn.addEventListener(\"click\", handleLoadMore);\n      }else{\n          loadMoreBtn.classList.add(hiddenClass);\n      }\n\n      } catch (error) {\n        onFetchError(error);\n      }finally {\n        form.reset();\n        if(page === maxPage){\n          loadMoreBtn.classList.add(hiddenClass);\n        iziToast.error({\n          title: 'Error',\n          message:\n            \"We're sorry, but you've reached the end of search results.\",\n        });\n        \n        }\n      }\n        \n        \n      })\n  \n}\n\n\nfunction fetchImage(name, page = 1){\n  return axios.get(`${BASE_URL}?key=${API_KEY}&q=${name}`,{\n  params : {\napiKey: API_KEY,\nq: name,\nimage_type: 'photo',\norientation: 'horizontal',\nsafesearch: true,\nper_page: 40,\npage,\n  }\n}).then(({data})=>data)};\n// const url = `${BASE_URL}?key=${API_KEY}&q=${name}&image_type=photo&orientation=horizontal&safesearch=true&per_page=40`;\n\n//     return fetch(url).then((resp)=> {\n//         if(!resp.ok){\n//             throw new Error(resp.statusText);\n//         }\n//         return resp.json();\n//     })\n    \n\n\nfunction createMarkup(arr) {\n  return arr\n    .map(\n      ({ webformatURL,\n        largeImageURL,\n        tags,\n        likes,\n        views,\n        comments,\n        downloads, }) => `\n  <li class=\"gallery-item\">\n  <a class=\"gallery-link\" href=\"${largeImageURL}\">\n    <img\n      class=\"gallery-image\"\n      src=\"${webformatURL}\"\n      alt=\"${tags}\"\n    />\n    <p class= \"gallery-descr\">• Likes: ${likes} • Views: ${views} • Comments: ${comments} •</span> Downloads:${downloads}</p>\n  </a>\n</li>\n  `\n    )\n    .join('');\n    \n}\n\nasync function handleLoadMore(){\n  page += 1;\n \nloadMoreBtn.disabled = true;\n  try {\n    const {hits, total} = await fetchImage(inputValue, page);\n\n    maxPage = Math.ceil(total / 40);\n    \n    \n    container.insertAdjacentHTML('beforeend', createMarkup(hits));\n    // const refreshPage = new SimpleLightbox('.gallery a', {\n    //   captionsData: 'alt',\n    //   captionDelay: 250,\n    // });\n    refreshPage.refresh();\n    scrollBy()\n} catch (error) {\n  onFetchError(error);\n}finally{\n  \n  loadMoreBtn.disabled = false;\n  if(page === maxPage){\n    loadMoreBtn.classList.add(hiddenClass);\n    loadMoreBtn.removeEventListener(\"click\", handleLoadMore)\n  iziToast.error({\n    title: 'Error',\n    message:\n      \"We're sorry, but you've reached the end of search results.\",\n  });\n  \n  }\n}\n}\n\nfunction onFetchError(error){\n  iziToast.error({\n    title: 'Error',\n    message:\n      'OOps... Plese try again',\n  });\n}\n\nfunction scrollBy() {\n  window.scrollBy({\n    top: 700,\n    behavior: 'smooth',\n  });\n}"],"names":["BASE_URL","API_KEY","container","form","loader","loadMoreBtn","hiddenClass","inputValue","page","maxPage","refreshPage","SimpleLightbox","handleSearch","event","fetchImage","data","iziToast","createMarkup","scrollBy","handleLoadMore","onFetchError","name","axios","arr","webformatURL","largeImageURL","tags","likes","views","comments","downloads","hits","total","error"],"mappings":"owBAOA,MAAMA,EAAU,2BACVC,EAAU,qCAEVC,EAAY,SAAS,cAAc,UAAU,EAC7CC,EAAO,SAAS,cAAc,cAAc,EACrC,SAAS,cAAc,eAAe,EACnC,SAAS,cAAc,YAAY,EACnD,MAAMC,EAAS,SAAS,cAAc,SAAS,EACzCC,EAAc,SAAS,cAAc,WAAW,EACpC,SAAS,cAAc,aAAa,EAEtD,MAAMC,EAAc,YACpB,IAAIC,EAAa,GACbC,EAAO,EACPC,EAAU,EAGd,MAAMC,EAAc,IAAIC,EAAe,aAAc,CACnD,aAAc,MACd,aAAc,GAChB,CAAC,EAKDP,EAAO,MAAM,QAAU,OACvBD,EAAK,iBAAiB,SAAUS,CAAY,EAE5C,SAASA,EAAaC,EAAM,CAC1BA,EAAM,eAAc,EACpBT,EAAO,MAAM,QAAU,QACvBG,EAAaM,EAAM,OAAO,SAAS,MAAM,MACzCC,EAAWP,CAAU,EACpB,KAAKQ,GAAQ,CACZX,EAAO,MAAM,QAAU,OACjBW,EAAK,KAAK,QACVC,EAAS,MAAM,CACX,MAAO,QACP,QACE,0EAChB,CAAa,EAEPd,EAAU,UAAY,GACtBM,EAAO,EACP,GAAI,CAEFN,EAAU,UAAYe,EAAaF,EAAK,IAAI,EAK5CL,EAAY,QAAO,EACnBQ,IAEGH,EAAK,UAAY,GAClBV,EAAY,UAAU,OAAOC,CAAW,EACxCD,EAAY,iBAAiB,QAASc,CAAc,GAEpDd,EAAY,UAAU,IAAIC,CAAW,CAGxC,MAAC,CACAc,EAAkB,CAC1B,QAAO,CACCjB,EAAK,MAAK,EACPK,IAASC,IACVJ,EAAY,UAAU,IAAIC,CAAW,EACvCU,EAAS,MAAM,CACb,MAAO,QACP,QACE,4DACZ,CAAS,EAGF,CAGP,CAAO,CAEP,CAGA,SAASF,EAAWO,EAAMb,EAAO,EAAE,CACjC,OAAOc,EAAM,IAAI,GAAGtB,SAAgBC,OAAaoB,IAAO,CACxD,OAAS,CACX,OAAQpB,EACR,EAAGoB,EACH,WAAY,QACZ,YAAa,aACb,WAAY,GACZ,SAAU,GACV,KAAAb,CACG,CACH,CAAC,EAAE,KAAK,CAAC,CAAC,KAAAO,CAAI,IAAIA,CAAI,CAAC,CAYvB,SAASE,EAAaM,EAAK,CACzB,OAAOA,EACJ,IACC,CAAC,CAAE,aAAAC,EACD,cAAAC,EACA,KAAAC,EACA,MAAAC,EACA,MAAAC,EACA,SAAAC,EACA,UAAAC,CAAY,IAAK;AAAA;AAAA,kCAESL;AAAA;AAAA;AAAA,aAGrBD;AAAA,aACAE;AAAA;AAAA,yCAE4BC,cAAkBC,iBAAqBC,wBAA+BC;AAAA;AAAA;AAAA,GAI1G,EACA,KAAK,EAAE,CAEZ,CAEA,eAAeX,GAAgB,CAC7BX,GAAQ,EAEVH,EAAY,SAAW,GACrB,GAAI,CACF,KAAM,CAAC,KAAA0B,EAAM,MAAAC,CAAK,EAAI,MAAMlB,EAAWP,EAAYC,CAAI,EAEvDC,EAAU,KAAK,KAAKuB,EAAQ,EAAE,EAG9B9B,EAAU,mBAAmB,YAAae,EAAac,CAAI,CAAC,EAK5DrB,EAAY,QAAO,EACnBQ,EAAU,CACd,MAAE,CACAE,EAAkB,CACpB,QAAC,CAECf,EAAY,SAAW,GACpBG,IAASC,IACVJ,EAAY,UAAU,IAAIC,CAAW,EACrCD,EAAY,oBAAoB,QAASc,CAAc,EACzDH,EAAS,MAAM,CACb,MAAO,QACP,QACE,4DACN,CAAG,EAGH,CACA,CAEA,SAASI,EAAaa,EAAM,CAC1BjB,EAAS,MAAM,CACb,MAAO,QACP,QACE,yBACN,CAAG,CACH,CAEA,SAASE,GAAW,CAClB,OAAO,SAAS,CACd,IAAK,IACL,SAAU,QACd,CAAG,CACH"}